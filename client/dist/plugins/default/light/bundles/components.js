"use strict";!function t(e,a,i){function s(r,o){if(!a[r]){if(!e[r]){var n="function"==typeof require&&require;if(!o&&n)return n(r,!0);if(h)return h(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var c=a[r]={exports:{}};e[r][0].call(c.exports,function(t){var a=e[r][1][t];return s(a?a:t)},c,c.exports,t,e,a,i)}return a[r].exports}for(var h="function"==typeof require&&require,r=0;r<i.length;r++)s(i[r]);return s}({1:[function(t,e,a){var i=this&&this.__extends||function(t,e){function a(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)},s=SupEngine.THREE,h=t("./LightUpdater"),r=function(t){function e(e){t.call(this,e,"Light"),this.color=16777215,this.intensity=1,this.distance=0,this.angle=Math.PI/3,this.target=new s.Vector3(0,0,0),this.castShadow=!1,this.shadow={mapSize:new s.Vector2(512,512),bias:0,camera:{near:.1,far:100,fov:50,left:-100,right:100,top:100,bottom:-100}},this.actor.gameInstance.threeRenderer.shadowMap.enabled=!0}return i(e,t),e.prototype.setType=function(t){switch(null!=this.light&&this.actor.threeObject.remove(this.light),this.type=t,t){case"ambient":this.light=new s.AmbientLight(this.color);break;case"point":this.light=new s.PointLight(this.color,this.intensity,this.distance);break;case"spot":var e=new s.SpotLight(this.color,this.intensity,this.distance,this.angle*Math.PI/180);e.target.position.copy(this.target),e.target.updateMatrixWorld(!1),e.shadow.mapSize.copy(this.shadow.mapSize),e.shadow.bias=this.shadow.bias,e.shadow.camera=new s.PerspectiveCamera(this.shadow.camera.fov,this.shadow.mapSize.x/this.shadow.mapSize.y,this.shadow.camera.near,this.shadow.camera.far),this.light=e,this.setCastShadow(this.castShadow);break;case"directional":var a=new s.DirectionalLight(this.color,this.intensity);a.target.position.copy(this.target),a.target.updateMatrixWorld(!1),a.shadow.mapSize.copy(this.shadow.mapSize),a.shadow.bias=this.shadow.bias,a.shadow.camera=new s.OrthographicCamera(this.shadow.camera.left,this.shadow.camera.right,this.shadow.camera.top,this.shadow.camera.bottom,this.shadow.camera.near,this.shadow.camera.far),this.light=a,this.setCastShadow(this.castShadow)}this.actor.threeObject.add(this.light),this.light.updateMatrixWorld(!1),this.actor.gameInstance.threeScene.traverse(function(t){var e=t.material;null!=e&&(e.needsUpdate=!0)})},e.prototype.setColor=function(t){this.color=t,this.light.color.setHex(this.color)},e.prototype.setIntensity=function(t){this.intensity=t,"ambient"!==this.type&&(this.light.intensity=t)},e.prototype.setDistance=function(t){this.distance=t,"point"!==this.type&&"spot"!==this.type||(this.light.distance=t)},e.prototype.setAngle=function(t){this.angle=t,"spot"===this.type&&(this.light.angle=this.angle*Math.PI/180)},e.prototype.setTarget=function(t,e,a){null!=t&&this.target.setX(t),null!=e&&this.target.setY(e),null!=a&&this.target.setZ(a),"spot"!==this.type&&"directional"!==this.type||(this.light.target.position.copy(this.target),this.light.target.updateMatrixWorld(!0))},e.prototype.setCastShadow=function(t){this.castShadow=t,"spot"!==this.type&&"directional"!==this.type||(this.light.castShadow=this.castShadow,this.actor.gameInstance.threeScene.traverse(function(t){var e=t.material;null!=e&&(e.needsUpdate=!0)}))},e.prototype.setShadowMapSize=function(t,e){if(null!=t&&(this.shadow.mapSize.x=t),null!=e&&(this.shadow.mapSize.y=e),"spot"===this.type||"directional"===this.type){var a=this.light.shadow;a.mapSize.copy(this.shadow.mapSize),this.setType(this.type)}},e.prototype.setShadowBias=function(t){if(this.shadow.bias=t,"spot"===this.type||"directional"===this.type){var e=this.light.shadow;e.bias=this.shadow.bias}},e.prototype.setShadowCameraNearPlane=function(t){if(this.shadow.camera.near=t,"spot"===this.type||"directional"===this.type){var e=this.light.shadow,a=e.camera;a.near=this.shadow.camera.near,a.updateProjectionMatrix()}},e.prototype.setShadowCameraFarPlane=function(t){if(this.shadow.camera.far=t,"spot"===this.type||"directional"===this.type){var e=this.light.shadow,a=e.camera;a.far=this.shadow.camera.far,a.updateProjectionMatrix()}},e.prototype.setShadowCameraFov=function(t){if(this.shadow.camera.fov=t,"spot"===this.type){var e=this.light.shadow,a=e.camera;a.fov=this.shadow.camera.fov,a.updateProjectionMatrix()}},e.prototype.setShadowCameraSize=function(t,e,a,i){if(null!=t&&(this.shadow.camera.top=t),null!=e&&(this.shadow.camera.bottom=e),null!=a&&(this.shadow.camera.left=a),null!=i&&(this.shadow.camera.right=i),"directional"===this.type){var s=this.light.shadow.camera;s.top=this.shadow.camera.top,s.bottom=this.shadow.camera.bottom,s.left=this.shadow.camera.left,s.right=this.shadow.camera.right,s.updateProjectionMatrix()}},e.prototype._destroy=function(){this.actor.threeObject.remove(this.light),this.castShadow&&this.actor.gameInstance.threeScene.traverse(function(t){var e=t.material;null!=e&&(e.needsUpdate=!0)}),t.prototype._destroy.call(this)},e.prototype.setIsLayerActive=function(t){this.light.visible=t},e.Updater=h.default,e}(SupEngine.ActorComponent);Object.defineProperty(a,"__esModule",{value:!0}),a.default=r},{"./LightUpdater":3}],2:[function(t,e,a){var i=this&&this.__extends||function(t,e){function a(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)},s=SupEngine.THREE,h=t("./Light"),r=function(t){function e(){t.apply(this,arguments)}return i(e,t),e.prototype.setType=function(e){switch(null!=this.lightMarker&&this.actor.gameInstance.threeScene.remove(this.lightMarker),null!=this.cameraHelper&&(this.actor.gameInstance.threeScene.remove(this.cameraHelper),this.cameraHelper=null),t.prototype.setType.call(this,e),e){case"ambient":this.lightMarker=null;break;case"point":this.lightMarker=new s.PointLightHelper(this.light,1);break;case"spot":this.lightMarker=new s.SpotLightHelper(this.light);break;case"directional":this.lightMarker=new s.DirectionalLightHelper(this.light,1)}null!=this.lightMarker&&(this.actor.gameInstance.threeScene.add(this.lightMarker),this.lightMarker.updateMatrixWorld(!0))},e.prototype.setColor=function(e){t.prototype.setColor.call(this,e),null!=this.lightMarker&&this.lightMarker.update()},e.prototype.setIntensity=function(e){t.prototype.setIntensity.call(this,e),null!=this.lightMarker&&this.lightMarker.update()},e.prototype.setDistance=function(e){t.prototype.setDistance.call(this,e),null!=this.lightMarker&&this.lightMarker.update()},e.prototype.setAngle=function(e){t.prototype.setAngle.call(this,e),null!=this.lightMarker&&this.lightMarker.update()},e.prototype.setTarget=function(e,a,i){t.prototype.setTarget.call(this,e,a,i),null!=this.lightMarker&&this.lightMarker.update()},e.prototype.setCastShadow=function(e){t.prototype.setCastShadow.call(this,e),e?(this.cameraHelper=new s.CameraHelper(this.light.shadow.camera),this.actor.gameInstance.threeScene.add(this.cameraHelper)):(this.actor.gameInstance.threeScene.remove(this.cameraHelper),this.cameraHelper=null)},e.prototype.setShadowCameraNearPlane=function(e){t.prototype.setShadowCameraNearPlane.call(this,e),null!=this.cameraHelper&&this.cameraHelper.update()},e.prototype.setShadowCameraFarPlane=function(e){t.prototype.setShadowCameraFarPlane.call(this,e),null!=this.cameraHelper&&this.cameraHelper.update()},e.prototype.setShadowCameraFov=function(e){t.prototype.setShadowCameraFov.call(this,e),null!=this.cameraHelper&&this.cameraHelper.update()},e.prototype.setShadowCameraSize=function(e,a,i,s){t.prototype.setShadowCameraSize.call(this,e,a,i,s),null!=this.cameraHelper&&this.cameraHelper.update()},e.prototype.update=function(){null!=this.lightMarker&&(this.lightMarker.updateMatrixWorld(!0),this.lightMarker.update()),this.actor.gameInstance.threeScene.updateMatrixWorld(!1)},e.prototype._destroy=function(){null!=this.lightMarker&&this.actor.gameInstance.threeScene.remove(this.lightMarker),null!=this.cameraHelper&&this.actor.gameInstance.threeScene.remove(this.cameraHelper),t.prototype._destroy.call(this)},e}(h.default);Object.defineProperty(a,"__esModule",{value:!0}),a.default=r},{"./Light":1}],3:[function(t,e,a){var i=SupEngine.THREE,s=function(){function t(t,e,a){var i=this;this.client=t,this.light=e,this.onLightResourceReceived=function(t,e){i.lightSettings=e,i.updateLightShadowMap()},this.onLightResourceEdited=function(t,e,a){"setProperty"===e&&"shadowMapType"===a&&i.updateLightShadowMap()},this.light.color=parseInt(a.color,16),this.light.intensity=a.intensity,this.light.distance=a.distance,this.light.angle=a.angle,this.light.target.set(a.target.x,a.target.y,a.target.z),this.light.castShadow=a.castShadow,this.light.shadow.mapSize.set(a.shadowMapSize.width,a.shadowMapSize.height),this.light.shadow.bias=a.shadowBias,this.light.shadow.camera.near=a.shadowCameraNearPlane,this.light.shadow.camera.far=a.shadowCameraFarPlane,this.light.shadow.camera.fov=a.shadowCameraFov,this.light.shadow.camera.left=a.shadowCameraSize.left,this.light.shadow.camera.right=a.shadowCameraSize.right,this.light.shadow.camera.top=a.shadowCameraSize.top,this.light.shadow.camera.bottom=a.shadowCameraSize.bottom,this.light.setType(a.type),this.lightSettingsSubscriber={onResourceReceived:this.onLightResourceReceived,onResourceEdited:this.onLightResourceEdited},this.client.subResource("lightSettings",this.lightSettingsSubscriber)}return t.prototype.destroy=function(){this.client.unsubResource("lightSettings",this.lightSettingsSubscriber)},t.prototype.config_setProperty=function(t,e){switch(t){case"type":this.light.setType(e);break;case"color":this.light.setColor(parseInt(e,16));break;case"intensity":this.light.setIntensity(e);break;case"distance":this.light.setDistance(e);break;case"angle":this.light.setAngle(e);break;case"target.x":this.light.setTarget(e,null,null);break;case"target.y":this.light.setTarget(null,e,null);break;case"target.z":this.light.setTarget(null,null,e);break;case"castShadow":this.light.setCastShadow(e);break;case"shadowMapSize.width":this.light.setShadowMapSize(e,null);break;case"shadowMapSize.height":this.light.setShadowMapSize(null,e);break;case"shadowBias":this.light.setShadowBias(e);break;case"shadowCameraNearPlane":this.light.setShadowCameraNearPlane(e);break;case"shadowCameraFarPlane":this.light.setShadowCameraFarPlane(e);break;case"shadowCameraFov":this.light.setShadowCameraFov(e);break;case"shadowCameraSize.top":this.light.setShadowCameraSize(e,null,null,null);break;case"shadowCameraSize.bottom":this.light.setShadowCameraSize(null,e,null,null);break;case"shadowCameraSize.left":this.light.setShadowCameraSize(null,null,e,null);break;case"shadowCameraSize.right":this.light.setShadowCameraSize(null,null,null,e)}},t.prototype.updateLightShadowMap=function(){switch(this.lightSettings.pub.shadowMapType){case"basic":this.light.actor.gameInstance.threeRenderer.shadowMap.type=i.BasicShadowMap;break;case"pcf":this.light.actor.gameInstance.threeRenderer.shadowMap.type=i.PCFShadowMap;break;case"pcfSoft":this.light.actor.gameInstance.threeRenderer.shadowMap.type=i.PCFSoftShadowMap}this.light.actor.gameInstance.threeScene.traverse(function(t){var e=t.material;null!=e&&(e.needsUpdate=!0)})},t}();Object.defineProperty(a,"__esModule",{value:!0}),a.default=s},{}],4:[function(t,e,a){var i=t("./Light"),s=t("./LightMarker");SupEngine.registerComponentClass("Light",i.default),SupEngine.registerEditorComponentClass("LightMarker",s.default)},{"./Light":1,"./LightMarker":2}]},{},[4]);