"use strict";!function t(e,i,s){function a(n,h){if(!i[n]){if(!e[n]){var o="function"==typeof require&&require;if(!h&&o)return o(n,!0);if(r)return r(n,!0);var p=new Error("Cannot find module '"+n+"'");throw p.code="MODULE_NOT_FOUND",p}var l=i[n]={exports:{}};e[n][0].call(l.exports,function(t){var i=e[n][1][t];return a(i?i:t)},l,l.exports,t,e,i,s)}return i[n].exports}for(var r="function"==typeof require&&require,n=0;n<s.length;n++)a(s[n]);return a}({1:[function(t,e,i){var s=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},a=SupEngine.THREE,r=t("./SpriteRendererUpdater"),n=function(t){function e(e){t.call(this,e,"SpriteRenderer"),this.color={r:1,g:1,b:1},this.hasFrameBeenUpdated=!1,this.materialType="basic",this.horizontalFlip=!1,this.verticalFlip=!1,this.castShadow=!1,this.receiveShadow=!1,this.playbackSpeed=1}return s(e,t),e.prototype.setSprite=function(t,e,i){if(this._clearMesh(),this.asset=t,null!=e&&(this.materialType=e),null!=i&&(this.shaderAsset=i),this.animationName=null,this.animationsByName={},null!=this.asset&&null!=this.asset.textures[this.asset.mapSlots.map]){if(this.frameToSecond=this.actor.gameInstance.framesPerSecond/this.asset.framesPerSecond,this.updateAnimationsByName(),this.geometry=new a.PlaneBufferGeometry(this.asset.grid.width,this.asset.grid.height),"shader"===this.materialType)this.material=SupEngine.componentClasses.Shader.createShaderMaterial(this.shaderAsset,this.asset.textures,this.geometry),this.material.map=this.asset.textures[this.asset.mapSlots.map];else{var s=void 0;"basic"===this.materialType?s=new a.MeshBasicMaterial:"phong"===this.materialType&&(s=new a.MeshPhongMaterial,s.lightMap=this.asset.textures[this.asset.mapSlots.light]),s.map=this.asset.textures[this.asset.mapSlots.map],s.specularMap=this.asset.textures[this.asset.mapSlots.specular],s.alphaMap=this.asset.textures[this.asset.mapSlots.alpha],"phong"===this.materialType&&(s.normalMap=this.asset.textures[this.asset.mapSlots.normal]),s.alphaTest=this.asset.alphaTest,this.material=s,this.setOpacity(this.opacity)}this.material.side=a.DoubleSide,this.setColor(this.color.r,this.color.g,this.color.b),this.threeMesh=new a.Mesh(this.geometry,this.material),this.setCastShadow(this.castShadow),this.threeMesh.receiveShadow=this.receiveShadow,this.setFrame(0),this.actor.threeObject.add(this.threeMesh),this.updateShape()}},e.prototype.setColor=function(t,e,i){if(this.color.r=t,this.color.g=e,this.color.b=i,null!=this.material){if(this.material instanceof a.ShaderMaterial){var s=this.material.uniforms;null!=s.color&&s.color.value.setRGB(t,e,i)}else this.material.color.setRGB(t,e,i);this.material.needsUpdate=!0}},e.prototype.updateShape=function(){if(null!=this.threeMesh){var t=1/this.asset.pixelsPerUnit;this.threeMesh.scale.set(t,t,t);var e;e=this.horizontalFlip?this.asset.origin.x-.5:.5-this.asset.origin.x;var i;i=this.verticalFlip?this.asset.origin.y-.5:.5-this.asset.origin.y,this.threeMesh.position.setX(e*this.asset.grid.width*t),this.threeMesh.position.setY(i*this.asset.grid.height*t),this.threeMesh.updateMatrixWorld(!1)}},e.prototype.setOpacity=function(t){this.opacity=t,null!=this.material&&(null!=this.opacity?(this.material.transparent=!0,this.material.opacity=this.opacity):(this.material.transparent=!1,this.material.opacity=1),this.material.needsUpdate=!0)},e.prototype.setHorizontalFlip=function(t){this.horizontalFlip=t,null!=this.asset&&(this.updateShape(),null==this.animationName?this.setFrame(0):this.updateFrame(!1))},e.prototype.setVerticalFlip=function(t){this.verticalFlip=t,null!=this.asset&&(this.updateShape(),null==this.animationName?this.setFrame(0):this.updateFrame(!1))},e.prototype.updateAnimationsByName=function(){this.animationsByName={};for(var t=0,e=this.asset.animations;t<e.length;t++){var i=e[t];this.animationsByName[i.name]=i}},e.prototype._clearMesh=function(){null!=this.threeMesh&&(this.actor.threeObject.remove(this.threeMesh),this.threeMesh.geometry.dispose(),this.threeMesh.material.dispose(),this.threeMesh=null,this.material=null)},e.prototype.setCastShadow=function(t){this.castShadow=t,this.threeMesh.castShadow=t,t&&this.actor.gameInstance.threeScene.traverse(function(t){var e=t.material;null!=e&&(e.needsUpdate=!0)})},e.prototype._destroy=function(){this._clearMesh(),this.asset=null,t.prototype._destroy.call(this)},e.prototype.setFrame=function(t){var e,i,s=this.material.map;if("rows"===this.asset.frameOrder){var a=Math.floor(s.size.width/this.asset.grid.width);e=t%a,i=Math.floor(t/a)}else{var r=Math.floor(s.size.height/this.asset.grid.height);e=Math.floor(t/r),i=t%r}var n=e*this.asset.grid.width/s.size.width,h=(e+1)*this.asset.grid.width/s.size.width,o=(s.size.height-(i+1)*this.asset.grid.height)/s.size.height,p=(s.size.height-i*this.asset.grid.height)/s.size.height;this.horizontalFlip&&(m=[h,n],n=m[0],h=m[1]),this.verticalFlip&&(u=[o,p],p=u[0],o=u[1]);var l=this.geometry.getAttribute("uv");l.needsUpdate=!0;var d=l.array;d[0]=n,d[1]=p,d[2]=h,d[3]=p,d[4]=n,d[5]=o,d[6]=h,d[7]=o;var m,u},e.prototype.setAnimation=function(t,e){if(void 0===e&&(e=!0),null!=t){var i=this.animationsByName[t];if(null==i)throw new Error("Animation "+t+" doesn't exist");if(this.animationLooping=e,t===this.animationName&&this.isAnimationPlaying)return;this.animation=i,this.animationName=t,this.playbackSpeed*i.speed>=0?this.animationTimer=0:this.animationTimer=this.getAnimationFrameCount()/this.frameToSecond-1,this.isAnimationPlaying=!0,this.updateFrame()}else this.animation=null,this.animationName=null,this.setFrame(0)},e.prototype.getAnimation=function(){return this.animationName},e.prototype.setAnimationFrameTime=function(t){if(null!=this.animationName){if(t<0||t>this.getAnimationFrameCount())throw new Error("Frame time must be >= 0 and < "+this.getAnimationFrameCount());this.animationTimer=t*this.frameToSecond,this.updateFrame()}},e.prototype.getAnimationFrameTime=function(){return null==this.animationName?0:this.computeAbsoluteFrameTime()-this.animation.startFrameIndex},e.prototype.getAnimationFrameIndex=function(){return null==this.animationName?0:Math.floor(this.computeAbsoluteFrameTime())-this.animation.startFrameIndex},e.prototype.getAnimationFrameCount=function(){return null==this.animationName?0:this.animation.endFrameIndex-this.animation.startFrameIndex+1},e.prototype.playAnimation=function(t){void 0===t&&(t=!0),this.animationLooping=t,this.isAnimationPlaying=!0,this.animationLooping||(this.playbackSpeed*this.animation.speed>0&&this.getAnimationFrameIndex()===this.getAnimationFrameCount()-1?this.animationTimer=0:this.playbackSpeed*this.animation.speed<0&&0===this.getAnimationFrameIndex()&&(this.animationTimer=(this.getAnimationFrameCount()-.01)*this.frameToSecond))},e.prototype.pauseAnimation=function(){this.isAnimationPlaying=!1},e.prototype.stopAnimation=function(){null!=this.animationName&&(this.isAnimationPlaying=!1,this.animationTimer=0,this.updateFrame())},e.prototype.computeAbsoluteFrameTime=function(){var t=this.animation.startFrameIndex;return t+=this.animationTimer/this.frameToSecond},e.prototype.updateFrame=function(t){void 0===t&&(t=!0),t&&(this.hasFrameBeenUpdated=!0);var e=Math.floor(this.computeAbsoluteFrameTime());e>this.animation.endFrameIndex?this.animationLooping?(e=this.animation.startFrameIndex,this.animationTimer=this.playbackSpeed*this.animation.speed):(e=this.animation.endFrameIndex,this.animationTimer=(this.getAnimationFrameCount()-.01)*this.frameToSecond,this.isAnimationPlaying=!1):e<this.animation.startFrameIndex&&(this.animationLooping?(e=this.animation.endFrameIndex,this.animationTimer=(this.getAnimationFrameCount()-.01)*this.frameToSecond+this.playbackSpeed*this.animation.speed):(e=this.animation.startFrameIndex,this.animationTimer=0,this.isAnimationPlaying=!1)),this.setFrame(e)},e.prototype.update=function(){if(null!=this.material){var t=this.material.uniforms;null!=t&&(t.time.value+=1/this.actor.gameInstance.framesPerSecond)}return this.hasFrameBeenUpdated?void(this.hasFrameBeenUpdated=!1):(this._tickAnimation(),void(this.hasFrameBeenUpdated=!1))},e.prototype._tickAnimation=function(){null!=this.animationName&&this.isAnimationPlaying&&(this.animationTimer+=this.playbackSpeed*this.animation.speed,this.updateFrame())},e.prototype.setIsLayerActive=function(t){null!=this.threeMesh&&(this.threeMesh.visible=t)},e.Updater=r.default,e}(SupEngine.ActorComponent);Object.defineProperty(i,"__esModule",{value:!0}),i.default=n},{"./SpriteRendererUpdater":2}],2:[function(t,e,i){var s=function(){function t(t,e,i,s){var a=this;this.client=t,this.spriteRenderer=e,this.externalSubscriber=s,this.looping=!0,this.overrideOpacity=!1,this.onSpriteAssetReceived=function(t,e){a.overrideOpacity||(a.spriteRenderer.opacity=e.pub.opacity),a.prepareMaps(e.pub.textures,function(){a.spriteAsset=e,a.setSprite(),null!=a.externalSubscriber.onAssetReceived&&a.externalSubscriber.onAssetReceived(t,e)})},this.onSpriteAssetEdited=function(t,e){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var r=!0,n=a.onEditCommands[e];null!=n&&n.apply(a,i)===!1&&(r=!1),r&&null!=a.externalSubscriber.onAssetEdited&&(h=a.externalSubscriber).onAssetEdited.apply(h,[t,e].concat(i));var h},this.onEditCommands={setMaps:function(t){return a.prepareMaps(a.spriteAsset.pub.textures,function(){a.setSprite(),null!=a.externalSubscriber.onAssetEdited&&a.externalSubscriber.onAssetEdited(a.spriteAsset.id,"setMaps")}),!1},setMapSlot:function(t,e){a.setSprite()},deleteMap:function(t){a.setSprite()},setProperty:function(t,e){switch(t){case"filtering":break;case"opacity":a.overrideOpacity||a.spriteRenderer.setOpacity(e);break;case"alphaTest":a.spriteRenderer.material.alphaTest=e,a.spriteRenderer.material.needsUpdate=!0;break;case"pixelsPerUnit":case"origin.x":case"origin.y":a.spriteRenderer.updateShape();break;default:a.setSprite()}},newAnimation:function(){a.spriteRenderer.updateAnimationsByName(),a.playAnimation()},deleteAnimation:function(){a.spriteRenderer.updateAnimationsByName(),a.playAnimation()},setAnimationProperty:function(){a.spriteRenderer.updateAnimationsByName(),a.playAnimation()}},this.onSpriteAssetTrashed=function(t){a.spriteAsset=null,a.spriteRenderer.setSprite(null),null!=a.externalSubscriber.onAssetTrashed&&a.externalSubscriber.onAssetTrashed(t)},this.onShaderAssetReceived=function(t,e){a.shaderPub=e.pub,a.setSprite()},this.onShaderAssetEdited=function(t,e){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];"editVertexShader"!==e&&"editFragmentShader"!==e&&a.setSprite()},this.onShaderAssetTrashed=function(){a.shaderPub=null,a.setSprite()},this.spriteAssetId=i.spriteAssetId,this.animationId=i.animationId,this.materialType=i.materialType,this.shaderAssetId=i.shaderAssetId,null==this.externalSubscriber&&(this.externalSubscriber={}),this.spriteRenderer.horizontalFlip=i.horizontalFlip,this.spriteRenderer.verticalFlip=i.verticalFlip,this.spriteRenderer.castShadow=i.castShadow,this.spriteRenderer.receiveShadow=i.receiveShadow,this.overrideOpacity=i.overrideOpacity,this.opacity=i.opacity,this.overrideOpacity&&this.spriteRenderer.setOpacity(this.opacity);var r=parseInt(i.color,16),n=(r>>16&255)/255,h=(r>>8&255)/255,o=(255&r)/255;this.spriteRenderer.setColor(n,h,o),this.spriteSubscriber={onAssetReceived:this.onSpriteAssetReceived,onAssetEdited:this.onSpriteAssetEdited,onAssetTrashed:this.onSpriteAssetTrashed},this.shaderSubscriber={onAssetReceived:this.onShaderAssetReceived,onAssetEdited:this.onShaderAssetEdited,onAssetTrashed:this.onShaderAssetTrashed},null!=this.spriteAssetId&&this.client.subAsset(this.spriteAssetId,"sprite",this.spriteSubscriber),null!=this.shaderAssetId&&this.client.subAsset(this.shaderAssetId,"shader",this.shaderSubscriber)}return t.prototype.destroy=function(){null!=this.spriteAssetId&&this.client.unsubAsset(this.spriteAssetId,this.spriteSubscriber),null!=this.shaderAssetId&&this.client.unsubAsset(this.shaderAssetId,this.shaderSubscriber)},t.prototype.prepareMaps=function(t,e){function i(){a--,0===a&&e()}var s=Object.keys(t),a=s.length;return 0===a?void e():void s.forEach(function(e){var s=t[e].image;s.complete?i():s.addEventListener("load",i)})},t.prototype.setSprite=function(){return null==this.spriteAsset||"shader"===this.materialType&&null==this.shaderPub?void this.spriteRenderer.setSprite(null):(this.spriteRenderer.setSprite(this.spriteAsset.pub,this.materialType,this.shaderPub),void(null!=this.animationId&&this.playAnimation()))},t.prototype.playAnimation=function(){var t=this.spriteAsset.animations.byId[this.animationId];null!=t&&this.spriteRenderer.setAnimation(t.name,this.looping)},t.prototype.config_setProperty=function(t,e){switch(t){case"spriteAssetId":null!=this.spriteAssetId&&this.client.unsubAsset(this.spriteAssetId,this.spriteSubscriber),this.spriteAssetId=e,this.spriteAsset=null,this.spriteRenderer.setSprite(null),null!=this.spriteAssetId&&this.client.subAsset(this.spriteAssetId,"sprite",this.spriteSubscriber);break;case"animationId":this.animationId=e,this.setSprite();break;case"looping":this.looping=e,null!=this.animationId&&this.playAnimation();break;case"horizontalFlip":this.spriteRenderer.setHorizontalFlip(e);break;case"verticalFlip":this.spriteRenderer.setVerticalFlip(e);break;case"castShadow":this.spriteRenderer.setCastShadow(e);break;case"receiveShadow":this.spriteRenderer.receiveShadow=e,this.spriteRenderer.threeMesh.receiveShadow=e,this.spriteRenderer.threeMesh.material.needsUpdate=!0;break;case"color":var i=parseInt(e,16),s=(i>>16&255)/255,a=(i>>8&255)/255,r=(255&i)/255;this.spriteRenderer.setColor(s,a,r);break;case"overrideOpacity":this.overrideOpacity=e,this.spriteRenderer.setOpacity(e?this.opacity:null!=this.spriteAsset?this.spriteAsset.pub.opacity:null);break;case"opacity":this.opacity=e,this.spriteRenderer.setOpacity(e);break;case"materialType":this.materialType=e,this.setSprite();break;case"shaderAssetId":null!=this.shaderAssetId&&this.client.unsubAsset(this.shaderAssetId,this.shaderSubscriber),this.shaderAssetId=e,this.shaderPub=null,this.spriteRenderer.setSprite(null),null!=this.shaderAssetId&&this.client.subAsset(this.shaderAssetId,"shader",this.shaderSubscriber)}},t}();Object.defineProperty(i,"__esModule",{value:!0}),i.default=s},{}],3:[function(t,e,i){var s=t("./SpriteRenderer");SupEngine.registerComponentClass("SpriteRenderer",s.default)},{"./SpriteRenderer":1}]},{},[3]);