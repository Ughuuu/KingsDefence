"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function e(t,i,s){function r(a,l){if(!i[a]){if(!t[a]){var h="function"==typeof require&&require;if(!l&&h)return h(a,!0);if(n)return n(a,!0);var o=new Error("Cannot find module '"+a+"'");throw o.code="MODULE_NOT_FOUND",o}var d=i[a]={exports:{}};t[a][0].call(d.exports,function(e){var i=t[a][1][e];return r(i?i:e)},d,d.exports,e,t,i,s)}return i[a].exports}for(var n="function"==typeof require&&require,a=0;a<s.length;a++)r(s[a]);return r}({1:[function(e,t,i){function s(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function n(e){return"number"==typeof e}function a(e){return"object"===("undefined"==typeof e?"undefined":_typeof(e))&&null!==e}function l(e){return void 0===e}t.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0,s.defaultMaxListeners=10,s.prototype.setMaxListeners=function(e){if(!n(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},s.prototype.emit=function(e){var t,i,s,n,h,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var d=new Error('Uncaught, unspecified "error" event. ('+t+")");throw d.context=t,d}if(i=this._events[e],l(i))return!1;if(r(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:n=Array.prototype.slice.call(arguments,1),i.apply(this,n)}else if(a(i))for(n=Array.prototype.slice.call(arguments,1),o=i.slice(),s=o.length,h=0;h<s;h++)o[h].apply(this,n);return!0},s.prototype.addListener=function(e,t){var i;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(i=l(this._maxListeners)?s.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},s.prototype.on=s.prototype.addListener,s.prototype.once=function(e,t){function i(){this.removeListener(e,i),s||(s=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var s=!1;return i.listener=t,this.on(e,i),this},s.prototype.removeListener=function(e,t){var i,s,n,l;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],n=i.length,s=-1,i===t||r(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(i)){for(l=n;l-- >0;)if(i[l]===t||i[l].listener&&i[l].listener===t){s=l;break}if(s<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(s,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},s.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[e],r(i))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},s.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},s.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},s.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(e,t,i){var s=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=SupEngine.THREE,n=function(e){function t(t,i,s,n){e.call(this),this.type="TileLayerGeometry";var a=new Float32Array(s*n*4*3),l=new Float32Array(s*n*4*3),h=new Float32Array(s*n*4*2);h.fill(-1);var o;o=a.length/3>65535?new Uint32Array(s*n*6):new Uint16Array(s*n*6);for(var d=0,u=0,c=0;c<n;c++)for(var p=c*i/n,f=0;f<s;f++){var g=f*t/s;a[d+0]=g,a[d+1]=p,l[d+2]=1,a[d+3]=g+t/s,a[d+4]=p,l[d+5]=1,a[d+6]=g+t/s,a[d+7]=p+i/n,l[d+8]=1,a[d+9]=g,a[d+10]=p+i/n,l[d+11]=1;var m=4*(f+c*s);o[u+0]=m+0,o[u+1]=m+1,o[u+2]=m+2,o[u+3]=m+0,o[u+4]=m+2,o[u+5]=m+3,d+=12,u+=6}this.setIndex(new r.BufferAttribute(o,1)),this.addAttribute("position",new r.BufferAttribute(a,3)),this.addAttribute("normal",new r.BufferAttribute(l,3)),this.addAttribute("uv",new r.BufferAttribute(h,2))}return s(t,e),t}(r.BufferGeometry);Object.defineProperty(i,"__esModule",{value:!0}),i.default=n},{}],3:[function(e,t,i){var s=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=e("events"),n=function(e){function t(t){e.call(this),this.data=t}return s(t,e),t.prototype.getWidth=function(){return this.data.width},t.prototype.getHeight=function(){return this.data.height},t.prototype.getPixelsPerUnit=function(){return this.data.pixelsPerUnit},t.prototype.getLayersDepthOffset=function(){return this.data.layerDepthOffset},t.prototype.getLayersCount=function(){return this.data.layers.length},t.prototype.getLayerId=function(e){return this.data.layers[e].id},t.prototype.setTileAt=function(e,t,i,s){if(!(t<0||i<0||t>=this.data.width||i>=this.data.height)){var r=i*this.data.width+t;this.data.layers[e].data[r]=null!=s?s:0,this.emit("setTileAt",e,t,i)}},t.prototype.getTileAt=function(e,t,i){if(t<0||i<0||t>=this.data.width||i>=this.data.height)return 0;var s=i*this.data.width+t;return this.data.layers[e].data[s]},t}(r.EventEmitter);Object.defineProperty(i,"__esModule",{value:!0}),i.default=n},{events:1}],4:[function(e,t,i){var s=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=SupEngine.THREE,n=e("./TileLayerGeometry"),a=e("./TileMapRendererUpdater"),l=function(e){function t(t){var i=this;e.call(this,t,"TileMapRenderer"),this.castShadow=!1,this.receiveShadow=!1,this.materialType="basic",this.onSetTileAt=function(e,t,s){i.refreshTileAt(e,t,s)}}return s(t,e),t.prototype.setTileMap=function(e,t,i){null!=this.layerMeshes&&this._clearLayerMeshes(),this.tileMap=e,null!=t&&(this.materialType=t),this.customShader=i,null!=this.tileSet&&null!=this.tileSet.data.texture&&null!=this.tileMap&&this._createLayerMeshes()},t.prototype.setTileSet=function(e){null!=this.layerMeshes&&this._clearLayerMeshes(),this.tileSet=e,null!=this.tileSet&&null!=this.tileSet.data.texture&&(this.tilesPerRow=this.tileSet.data.texture.image.width/this.tileSet.data.grid.width,this.tilesPerColumn=this.tileSet.data.texture.image.height/this.tileSet.data.grid.height,null!=this.tileMap&&this._createLayerMeshes())},t.prototype._createLayerMeshes=function(){this.layerMeshes=[],this.layerMeshesById={},this.layerVisibleById={};for(var e=0;e<this.tileMap.getLayersCount();e++){var t=this.tileMap.getLayerId(e);this.addLayer(t,e)}this.setCastShadow(this.castShadow),this.tileMap.on("setTileAt",this.onSetTileAt)},t.prototype._clearLayerMeshes=function(){for(var e=0,t=this.layerMeshes;e<t.length;e++){var i=t[e];i.geometry.dispose(),i.material.dispose(),this.actor.threeObject.remove(i)}this.layerMeshes=null,this.layerMeshesById=null,this.layerVisibleById=null,this.tileMap.removeListener("setTileAt",this.onSetTileAt)},t.prototype._destroy=function(){null!=this.layerMeshes&&this._clearLayerMeshes(),this.tileMap=null,this.tileSet=null,e.prototype._destroy.call(this)},t.prototype.addLayer=function(e,t){var i,s,a=this.tileMap.getWidth()*this.tileSet.data.grid.width,l=this.tileMap.getHeight()*this.tileSet.data.grid.height,h=new n.default(a,l,this.tileMap.getWidth(),this.tileMap.getHeight());switch(this.materialType){case"basic":i={formatVersion:null,vertexShader:{text:r.ShaderLib.basic.vertexShader,draft:null,revisionId:null},fragmentShader:{text:"// Copied (and slightly adapted for Superpowers) from https://github.com/mrdoob/three.js/blob/dev/src/renderers/shaders/ShaderLib/meshbasic_frag.glsl\n\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\t// Superpowers modification to discard empty tiles\n\tif (vUv.x < 0.0 && vUv.y < 0.0) discard;\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight;\n\treflectedLight.directDiffuse = vec3( 0.0 );\n\treflectedLight.directSpecular = vec3( 0.0 );\n\treflectedLight.indirectDiffuse = diffuseColor.rgb;\n\treflectedLight.indirectSpecular = vec3( 0.0 );\n\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}",draft:null,revisionId:null},uniforms:[{id:null,name:"map",type:"t",value:"map"}],attributes:[],useLightUniforms:!1},s=r.ShaderLib.basic.uniforms;break;case"phong":i={formatVersion:null,vertexShader:{text:r.ShaderLib.phong.vertexShader,draft:null,revisionId:null},fragmentShader:{text:"// Copied (and slightly adapted for Superpowers) from https://github.com/mrdoob/three.js/blob/dev/src/renderers/shaders/ShaderLib/meshphong_frag.glsl\n\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\t// Superpowers modification to discard empty tiles\n\tif (vUv.x < 0.0 && vUv.y < 0.0) discard;\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}",draft:null,revisionId:null},uniforms:[{id:null,name:"map",type:"t",value:"map"}],attributes:[],useLightUniforms:!0},s=r.ShaderLib.phong.uniforms;break;case"shader":i=this.customShader}var o=SupEngine.componentClasses.Shader.createShaderMaterial(i,{map:this.tileSet.data.texture},h,{defaultUniforms:s});o.map=this.tileSet.data.texture,o.alphaTest=.1,o.side=r.DoubleSide,o.transparent=!0;var d=new r.Mesh(h,o);d.receiveShadow=this.receiveShadow;var u=1/this.tileMap.getPixelsPerUnit();d.scale.set(u,u,1),d.updateMatrixWorld(!1),this.layerMeshes.splice(t,0,d),this.layerMeshesById[e]=d,this.layerVisibleById[e]=!0,this.actor.threeObject.add(d);for(var c=0;c<this.tileMap.getHeight();c++)for(var p=0;p<this.tileMap.getWidth();p++)this.refreshTileAt(t,p,c);this.refreshLayersDepth()},t.prototype.deleteLayer=function(e){this.actor.threeObject.remove(this.layerMeshes[e]),this.layerMeshes.splice(e,1),this.refreshLayersDepth()},t.prototype.moveLayer=function(e,t){var i=this.layerMeshesById[e],s=this.layerMeshes.indexOf(i);this.layerMeshes.splice(s,1),s<t&&t--,this.layerMeshes.splice(t,0,i),this.refreshLayersDepth()},t.prototype.setCastShadow=function(e){this.castShadow=e;for(var t=0,i=this.layerMeshes;t<i.length;t++){var s=i[t];s.castShadow=e}e&&this.actor.gameInstance.threeScene.traverse(function(e){var t=e.material;null!=t&&(t.needsUpdate=!0)})},t.prototype.setReceiveShadow=function(e){this.receiveShadow=e;for(var t=0,i=this.layerMeshes;t<i.length;t++){var s=i[t];s.receiveShadow=e,s.material.needsUpdate=!0}},t.prototype.refreshPixelsPerUnit=function(e){for(var t=1/this.tileMap.getPixelsPerUnit(),i=0,s=this.layerMeshes;i<s.length;i++){var r=s[i];r.scale.set(t,t,1),r.updateMatrixWorld(!1)}},t.prototype.refreshLayersDepth=function(){for(var e=0;e<this.layerMeshes.length;e++){var t=this.layerMeshes[e];t.position.setZ(e*this.tileMap.getLayersDepthOffset()),t.updateMatrixWorld(!1)}},t.prototype.refreshEntireMap=function(){for(var e=0;e<this.tileMap.getLayersCount();e++)for(var t=0;t<this.tileMap.getWidth();t++)for(var i=0;i<this.tileMap.getHeight();i++)this.refreshTileAt(e,i,t);this.refreshLayersDepth()},t.prototype.refreshTileAt=function(e,t,i){var s=-1,r=-1,n=!1,a=!1,l=0,h=this.tileMap.getTileAt(e,t,i);0!==h&&(s=h[0],r=h[1],n=h[2],a=h[3],l=h[4]);var o=t+i*this.tileMap.getWidth(),d=this.layerMeshes[e],u=d.geometry.getAttribute("uv");u.needsUpdate=!0;var c=u.array;if(s===-1||r===-1||s>=this.tilesPerRow||r>=this.tilesPerColumn)for(var p=0;p<8;p++)c[8*o+p]=-1;else{var f=this.tileSet.data.texture.image,g=(s*this.tileSet.data.grid.width+.2)/f.width,m=((s+1)*this.tileSet.data.grid.width-.2)/f.width,v=1-((r+1)*this.tileSet.data.grid.height-.2)/f.height,S=1-(r*this.tileSet.data.grid.height+.2)/f.height;switch(n&&(y=[g,m],m=y[0],g=y[1]),a&&(b=[v,S],S=b[0],v=b[1]),l){case 0:c[8*o+0]=g,c[8*o+1]=v,c[8*o+2]=m,c[8*o+3]=v,c[8*o+4]=m,c[8*o+5]=S,c[8*o+6]=g,c[8*o+7]=S;break;case 90:c[8*o+0]=g,c[8*o+1]=S,c[8*o+2]=g,c[8*o+3]=v,c[8*o+4]=m,c[8*o+5]=v,c[8*o+6]=m,c[8*o+7]=S;break;case 180:c[8*o+0]=m,c[8*o+1]=S,c[8*o+2]=g,c[8*o+3]=S,c[8*o+4]=g,c[8*o+5]=v,c[8*o+6]=m,c[8*o+7]=v;break;case 270:c[8*o+0]=m,c[8*o+1]=v,c[8*o+2]=m,c[8*o+3]=S,c[8*o+4]=g,c[8*o+5]=S,c[8*o+6]=g,c[8*o+7]=v}var y,b}},t.prototype.setIsLayerActive=function(e){if(null!=this.layerMeshes)for(var t in this.layerMeshesById)this.layerMeshesById[t].visible=e&&this.layerVisibleById[t]},t.Updater=a.default,t}(SupEngine.ActorComponent);Object.defineProperty(i,"__esModule",{value:!0}),i.default=l},{"./TileLayerGeometry":2,"./TileMapRendererUpdater":5}],5:[function(e,t,i){var s=e("./TileMap"),r=e("./TileSet"),n=function(){function e(e,t,i,s){var n=this;this.client=e,this.tileMapRenderer=t,this.externalSubscribers=s,this.onTileMapAssetReceived=function(e,t){n.tileMapAsset=t,n.setTileMap(),null!=n.tileMapAsset.pub.tileSetId&&n.client.subAsset(n.tileMapAsset.pub.tileSetId,"tileSet",n.tileSetSubscriber);var i=n.externalSubscribers.tileMap;null!=i.onAssetReceived&&i.onAssetReceived(e,t)},this.onTileMapAssetEdited=function(e,t){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];if(null!=n.tileSetAsset||"changeTileSet"===t){var r=n.onEditCommands[t];null!=r&&r.apply(n,i)}var a=n.externalSubscribers.tileMap;a.onAssetEdited&&a.onAssetEdited.apply(a,[e,t].concat(i))},this.onEditCommands={changeTileSet:function(){null!=n.tileSetAssetId&&n.client.unsubAsset(n.tileSetAssetId,n.tileSetSubscriber),n.tileSetAsset=null,n.tileMapRenderer.setTileSet(null),n.tileSetAssetId=n.tileMapAsset.pub.tileSetId,null!=n.tileSetAssetId&&n.client.subAsset(n.tileSetAssetId,"tileSet",n.tileSetSubscriber)},resizeMap:function(){n.setTileMap()},moveMap:function(){n.tileMapRenderer.refreshEntireMap()},setProperty:function(e,t){switch(e){case"pixelsPerUnit":n.tileMapRenderer.refreshPixelsPerUnit(t);break;case"layerDepthOffset":n.tileMapRenderer.refreshLayersDepth()}},editMap:function(e,t){for(var i=n.tileMapAsset.pub.layers.indexOf(n.tileMapAsset.layers.byId[e]),s=0,r=t;s<r.length;s++){var a=r[s];n.tileMapRenderer.refreshTileAt(i,a.x,a.y)}},newLayer:function(e,t){n.tileMapRenderer.addLayer(e.id,t)},deleteLayer:function(e,t){n.tileMapRenderer.deleteLayer(t)},moveLayer:function(e,t){n.tileMapRenderer.moveLayer(e,t)}},this.onTileMapAssetTrashed=function(e){n.tileMapRenderer.setTileMap(null);var t=n.externalSubscribers.tileMap;null!=t.onAssetTrashed&&t.onAssetTrashed(e)},this.onTileSetAssetReceived=function(e,t){n.prepareTexture(t.pub.texture,function(){n.tileSetAsset=t,n.tileMapRenderer.setTileSet(new r.default(t.pub));var i=n.externalSubscribers.tileSet;null!=i.onAssetReceived&&i.onAssetReceived(e,t)})},this.onTileSetAssetEdited=function(e,t){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var r=n.onTileSetEditCommands[t];null!=r&&r.apply(n,i);var a=n.externalSubscribers.tileSet;a.onAssetEdited&&a.onAssetEdited.apply(a,[e,t].concat(i))},this.onTileSetEditCommands={upload:function(){var e=this;this.prepareTexture(this.tileSetAsset.pub.texture,function(){e.tileMapRenderer.setTileSet(new r.default(e.tileSetAsset.pub))})},setProperty:function(){this.tileMapRenderer.setTileSet(new r.default(this.tileSetAsset.pub))}},this.onTileSetAssetTrashed=function(e){n.tileMapRenderer.setTileSet(null);var t=n.externalSubscribers.tileSet;t.onAssetTrashed&&t.onAssetTrashed(e)},this.onShaderAssetReceived=function(e,t){n.shaderPub=t.pub,n.setTileMap()},this.onShaderAssetEdited=function(e,t){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];"editVertexShader"!==t&&"editFragmentShader"!==t&&n.setTileMap()},this.onShaderAssetTrashed=function(){n.shaderPub=null,n.setTileMap()},this.tileMapAssetId=i.tileMapAssetId,this.tileSetAssetId=i.tileSetAssetId,this.materialType=i.materialType,this.shaderAssetId=i.shaderAssetId,this.tileMapRenderer.receiveShadow=i.receiveShadow,null==this.externalSubscribers&&(this.externalSubscribers={}),null==this.externalSubscribers.tileMap&&(this.externalSubscribers.tileMap={}),null==this.externalSubscribers.tileSet&&(this.externalSubscribers.tileSet={}),this.tileMapSubscriber={onAssetReceived:this.onTileMapAssetReceived,onAssetEdited:this.onTileMapAssetEdited,onAssetTrashed:this.onTileMapAssetTrashed},this.tileSetSubscriber={onAssetReceived:this.onTileSetAssetReceived,onAssetEdited:this.onTileSetAssetEdited,onAssetTrashed:this.onTileSetAssetTrashed},this.shaderSubscriber={onAssetReceived:this.onShaderAssetReceived,onAssetEdited:this.onShaderAssetEdited,onAssetTrashed:this.onShaderAssetTrashed},null!=this.tileMapAssetId&&this.client.subAsset(this.tileMapAssetId,"tileMap",this.tileMapSubscriber),null!=this.shaderAssetId&&this.client.subAsset(this.shaderAssetId,"shader",this.shaderSubscriber)}return e.prototype.destroy=function(){null!=this.tileMapAssetId&&this.client.unsubAsset(this.tileMapAssetId,this.tileMapSubscriber),null!=this.tileSetAssetId&&this.client.unsubAsset(this.tileSetAssetId,this.tileSetSubscriber),null!=this.shaderAssetId&&this.client.unsubAsset(this.shaderAssetId,this.shaderSubscriber)},e.prototype.setTileMap=function(){return null==this.tileMapAsset||"shader"===this.materialType&&null==this.shaderPub?void this.tileMapRenderer.setTileMap(null):void this.tileMapRenderer.setTileMap(new s.default(this.tileMapAsset.pub),this.materialType,this.shaderPub)},e.prototype.prepareTexture=function(e,t){return null==e?void t():void(e.image.complete?t():e.image.addEventListener("load",t))},e.prototype.config_setProperty=function(e,t){switch(e){case"tileMapAssetId":null!=this.tileMapAssetId&&this.client.unsubAsset(this.tileMapAssetId,this.tileMapSubscriber),this.tileMapAssetId=t,this.tileMapAsset=null,this.tileMapRenderer.setTileMap(null),null!=this.tileSetAssetId&&this.client.unsubAsset(this.tileSetAssetId,this.tileSetSubscriber),this.tileSetAsset=null,this.tileMapRenderer.setTileSet(null),null!=this.tileMapAssetId&&this.client.subAsset(this.tileMapAssetId,"tileMap",this.tileMapSubscriber);break;case"castShadow":this.tileMapRenderer.setCastShadow(t);break;case"receiveShadow":this.tileMapRenderer.setReceiveShadow(t);break;case"materialType":this.materialType=t,this.setTileMap();break;case"shaderAssetId":null!=this.shaderAssetId&&this.client.unsubAsset(this.shaderAssetId,this.shaderSubscriber),this.shaderAssetId=t,this.shaderPub=null,this.tileMapRenderer.setTileMap(null),null!=this.shaderAssetId&&this.client.subAsset(this.shaderAssetId,"shader",this.shaderSubscriber)}},e}();Object.defineProperty(i,"__esModule",{value:!0}),i.default=n},{"./TileMap":3,"./TileSet":6}],6:[function(e,t,i){var s=function(){function e(e){this.data=e}return e}();Object.defineProperty(i,"__esModule",{value:!0}),i.default=s},{}],7:[function(e,t,i){var s=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=SupEngine.THREE,n=e("./TileSetRendererUpdater"),a=function(e){function t(t,i){e.call(this,t,"TileSetRenderer"),this.material=new r.MeshBasicMaterial({alphaTest:.1,side:r.DoubleSide,transparent:!0});var s=new SupEngine.Actor(this.actor.gameInstance,"Grid");s.setLocalPosition(new r.Vector3(0,0,1)),this.gridRenderer=new SupEngine.editorComponentClasses.GridRenderer(s,{width:1,height:1,direction:-1,orthographicScale:10,ratio:{x:1,y:1}}),this.selectedTileActor=new SupEngine.Actor(this.actor.gameInstance,"Selection",null,{visible:!1}),new SupEngine.editorComponentClasses.FlatColorRenderer(this.selectedTileActor,9437328,1,1),this.setTileSet(i)}return s(t,e),t.prototype.setTileSet=function(e){if(this._clearMesh(),this.asset=e,null!=this.asset){var t=new r.PlaneBufferGeometry(e.data.texture.image.width,e.data.texture.image.height);this.material.map=e.data.texture,this.mesh=new r.Mesh(t,this.material),this.actor.threeObject.add(this.mesh),this.refreshScaleRatio(),this.selectedTileActor.threeObject.visible=!0}},t.prototype.select=function(e,t,i,s){void 0===i&&(i=1),void 0===s&&(s=1);var n=this.asset.data.grid.width/this.asset.data.grid.height;this.selectedTileActor.setLocalPosition(new r.Vector3(e,-t/n,2)),this.selectedTileActor.setLocalScale(new r.Vector3(i,-s/n,1))},t.prototype.refreshScaleRatio=function(){var e=1/this.asset.data.grid.width,t=1/this.asset.data.grid.height;this.mesh.scale.set(e,t,1);var i=this.mesh.material;this.mesh.position.setX(i.map.image.width/2*e),this.mesh.position.setY(-i.map.image.height/2*t),this.mesh.updateMatrixWorld(!1),this.select(0,0)},t.prototype._clearMesh=function(){null!=this.mesh&&(this.mesh.geometry.dispose(),this.mesh.material.dispose(),this.actor.threeObject.remove(this.mesh),this.mesh=null,this.selectedTileActor.threeObject.visible=!1)},t.prototype._destroy=function(){this._clearMesh(),this.actor.gameInstance.destroyActor(this.gridRenderer.actor),this.actor.gameInstance.destroyActor(this.selectedTileActor),this.asset=null,e.prototype._destroy.call(this)},t.prototype.setIsLayerActive=function(e){null!=this.mesh&&(this.mesh.visible=e)},t.Updater=n.default,t}(SupEngine.ActorComponent);Object.defineProperty(i,"__esModule",{value:!0}),i.default=a},{"./TileSetRendererUpdater":8}],8:[function(e,t,i){var s=e("./TileSet"),r=function(){function e(e,t,i,r){var n=this;this.client=e,this.tileSetRenderer=t,this.externalSubscriber=r,this.onTileSetAssetReceived=function(e,t){n.prepareTexture(t.pub.texture,function(){n.tileSetAsset=t,null!=t.pub.texture&&(n.tileSetRenderer.setTileSet(new s.default(t.pub)),n.tileSetRenderer.gridRenderer.setGrid({width:t.pub.texture.image.width/t.pub.grid.width,height:t.pub.texture.image.height/t.pub.grid.height,direction:-1,orthographicScale:10,ratio:{x:1,y:t.pub.grid.width/t.pub.grid.height}})),null!=n.externalSubscriber.onAssetReceived&&n.externalSubscriber.onAssetReceived(e,t)})},this.onTileSetAssetEdited=function(e,t){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var r=!0,a=n.onEditCommands[t];null!=a&&a.apply(void 0,i)===!1&&(r=!1),r&&null!=n.externalSubscriber.onAssetEdited&&(l=n.externalSubscriber).onAssetEdited.apply(l,[e,t].concat(i));var l},this.onEditCommands={upload:function(){var e=n.tileSetAsset.pub.texture;return n.prepareTexture(e,function(){n.tileSetRenderer.setTileSet(new s.default(n.tileSetAsset.pub));var t=e.image.width/n.tileSetAsset.pub.grid.width,i=e.image.height/n.tileSetAsset.pub.grid.height;n.tileSetRenderer.gridRenderer.resize(t,i),n.tileSetRenderer.gridRenderer.setRatio({x:1,y:n.tileSetAsset.pub.grid.width/n.tileSetAsset.pub.grid.height}),null!=n.externalSubscriber.onAssetEdited&&n.externalSubscriber.onAssetEdited(n.tileSetAsset.id,"upload")}),!1},setProperty:function(e,t){switch(e){case"grid.width":case"grid.height":n.tileSetRenderer.refreshScaleRatio();var i=n.tileSetAsset.pub.texture.image.width/n.tileSetAsset.pub.grid.width,s=n.tileSetAsset.pub.texture.image.height/n.tileSetAsset.pub.grid.height;n.tileSetRenderer.gridRenderer.resize(i,s),n.tileSetRenderer.gridRenderer.setRatio({x:1,y:n.tileSetAsset.pub.grid.width/n.tileSetAsset.pub.grid.height})}}},this.onTileSetAssetTrashed=function(e){n.tileSetRenderer.setTileSet(null),null!=n.externalSubscriber.onAssetTrashed&&n.externalSubscriber.onAssetTrashed(e)},this.client=e,this.tileSetRenderer=t,this.tileSetAssetId=i.tileSetAssetId,null==this.externalSubscriber&&(this.externalSubscriber={}),this.tileSetSubscriber={onAssetReceived:this.onTileSetAssetReceived,onAssetEdited:this.onTileSetAssetEdited,onAssetTrashed:this.onTileSetAssetTrashed},null!=this.tileSetAssetId&&this.client.subAsset(this.tileSetAssetId,"tileSet",this.tileSetSubscriber)}return e.prototype.destroy=function(){null!=this.tileSetAssetId&&this.client.unsubAsset(this.tileSetAssetId,this.tileSetSubscriber)},e.prototype.changeTileSetId=function(e){null!=this.tileSetAssetId&&this.client.unsubAsset(this.tileSetAssetId,this.tileSetSubscriber),this.tileSetAssetId=e,this.tileSetAsset=null,this.tileSetRenderer.setTileSet(null),this.tileSetRenderer.gridRenderer.resize(1,1),null!=this.tileSetAssetId&&this.client.subAsset(this.tileSetAssetId,"tileSet",this.tileSetSubscriber)},e.prototype.prepareTexture=function(e,t){return null==e?void t():void(e.image.complete?t():e.image.addEventListener("load",t))},e}();Object.defineProperty(i,"__esModule",{value:!0}),i.default=r},{"./TileSet":6}],9:[function(e,t,i){var s=e("./TileMapRenderer"),r=e("./TileSetRenderer");SupEngine.registerComponentClass("TileMapRenderer",s.default),SupEngine.registerEditorComponentClass("TileSetRenderer",r.default)},{"./TileMapRenderer":4,"./TileSetRenderer":7}]},{},[9]);